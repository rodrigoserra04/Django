{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Details</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    
    <style>
        .edit-icon {
            cursor: pointer;
            margin-left: 10px;
            vertical-align: middle;
            color: #007bff;
            transition: color 0.3s;
        }

        .edit-icon:hover {
            color: #0056b3;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            margin: 20px auto;
            max-width: 800px;
        }

        h1 {
            color: #007bff;
            text-align: center;
            margin-bottom: 20px;
        }

        /* DatePicker */
        .ui-datepicker {
            font-family: Arial, sans-serif;
            font-size: 14px;
        }

        .ui-datepicker-header {
            background-color: #007bff;
            border: none;
            color: white;
        }

        .ui-datepicker-prev, .ui-datepicker-next {
            display: none;
        }

        .ui-datepicker-calendar {
            border: none;
        }

        .ui-datepicker-calendar tbody td {
            padding: 5px;
        }

        .ui-datepicker-calendar tbody td a {
            color: #333;
            text-decoration: none;
        }

        .ui-datepicker-calendar tbody td a:hover {
            color: #007bff;
        }

        .ui-datepicker-current-day {
            background-color: #007bff !important;
            border-radius: 50%;
        }

        .ui-datepicker-month, .ui-datepicker-year {
            color: white;
        }

        .ui-datepicker-close {
            display: none;
        }
    </style>
</head>
<body>
    {% include 'navbar.html' %}
    <div class="main-content">
        <h1>Task Details</h1>
        
        <div id="task-details">
            <p><strong>Title:</strong> <span id="task-title">{{ task.title }}</span> <span class="edit-icon" id="edit-btn">✏️</span></p>
            <p><strong>Description:</strong> <span id="task-description">{{ task.description }}</span></p>
            <p><strong>Status:</strong> 
                <span class="task-status {% if task.status == 'pending' %}task-status--pending{% elif task.status == 'doing' %}task-status--doing{% else %}task-status--done{% endif %}" id="task-status">
                    {{ task.get_status_display }}
                </span>
            </p>
            <p><strong>Priority:</strong> 
                <span class="task-priority {% if task.priority == 'low' %}task-priority--low{% elif task.priority == 'medium' %}task-priority--medium{% else %}task-priority--high{% endif %}" id="task-priority">
                    {{ task.priority }}
                </span>
            </p>
            {% if task.ai_description %}
                <p><strong>Description generated by AI:</strong> {{ task.ai_description }}</p>
            {% endif %}
            <p><strong>Creation Date:</strong> {{ task.created_at|date:'d F Y' }}</p>
            {% if task.due_date %}
                <p><strong>Due Date:</strong> {{ task.due_date|date:'d F Y' }}</p>
            {% endif %}
            {% if task.completed_at %}
                <p><strong>Completed At:</strong> {{ task.completed_at }}</p>
            {% endif %}
            <p><strong>Created by:</strong> {{ task.user }}</p>
        </div>

        <form id="edit-task-form" method="post" action="" style="display: none;">
            {% csrf_token %}
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" value="{{ task.title }}" required>

            <label for="description">Description:</label>
            <textarea id="description" name="description" required>{{ task.description }}</textarea>

            <label for="status">Status:</label>
            <select id="status" name="status" value="{{ task.status }}" required>
                <option value="Pending" {% if task.status == 'Pending' %}selected{% endif %}>Pending</option>
                <option value="Doing" {% if task.status == 'Doing' %}selected{% endif %}>In Progress</option>
                <option value="Done" {% if task.status == 'Done' %}selected{% endif %}>Done</option>
            </select>

            <label for="status">Priority:</label>
            <select id="priority" name="priority" value="{{ task.priority }}"required>
                <option value="Low" {% if task.priority == 'Low' %}selected{% endif %}>Low</option>
                <option value="Medium" {% if task.priority == 'Medium' %}selected{% endif %}>Medium</option>
                <option value="High" {% if task.priority == 'High' %}selected{% endif %}>High</option>
            </select>

            <label for="due_date">Due Date:</label>
            <input type="text" id="due_date" name="due_date" value="{{ task.due_date|date:'d-m-Y' }}">

            <div class="form-actions">
                <button type="submit" class="btn">Save Changes</button>
                <button type="button" id="cancel-btn" class="btn btn-secondary">Cancel</button>
            </div>
        </form>
    </div>
    {% include 'footer.html' %}
    
    <script>
        document.getElementById('edit-btn').addEventListener('click', function() {
            document.getElementById('task-details').style.display = 'none';
            document.getElementById('edit-task-form').style.display = 'block';
        });

        document.getElementById('cancel-btn').addEventListener('click', function() {
            document.getElementById('edit-task-form').style.display = 'none';
            document.getElementById('task-details').style.display = 'block';
        });
        $( function() {
            $( "#due_date" ).datepicker({ 
                dateFormat: 'dd-mm-yy', 
                dayNamesMin: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                monthNamesShort: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']
            });
        });

    </script>
</body>
</html>
